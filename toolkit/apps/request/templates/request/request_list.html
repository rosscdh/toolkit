{% extends 'gui.html' %}{% load request_tags %}

{% block body %}
    <div id="requests" class="content">
        <div class="content-header requests-header clearfix">
            <div class="container">
                <div class="col-sm-8 col-sm-offset-2">
                    <h3>{% if object_list.count > 0 %}<span class="circle">{{ object_list.count }}</span> {% endif %}Requests</h3>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2" role="main">
                    {% if object_list %}
                        {% request_uploads_section object_list request.user %}
                        {% request_reviews_section object_list request.user %}
                        {% request_signings_section object_list request.user %}
                    {% else %}
                        <div class="col-md-12 text-center">
                            <h6 class="text-muted">You currently have no open requests.</h6>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript" src="//api.filepicker.io/v1/filepicker.js"></script>
    <script src="{{ STATIC_URL }}js/filepicker.js"></script>
    <script>
    'use strict';
    jQuery( document ).ready(function () {

        var user_has_viewed_url = '{% url "matter_item_specific_revision_user_viewed" matter_slug="matterSlug" item_slug="itemSlug" reviewdocument_slug="reviewDocSlug" %}';
        $('.modal').on('hide.bs.modal', function (event) {
          // do somethingâ€¦
            var self = $(this);
            var data = self.data();
            var url = user_has_viewed_url.replace('reviewDocSlug', data.reviewdocument_slug).replace('itemSlug', data.item_slug).replace('matterSlug', data.matter_slug)
            console.log(data)
            console.log(url)
            $.ajax({
                url: url,
                type: "PATCH",
                data: {'user': '{{ user.username }}'},
                dataType: 'json',
                beforeSend: function (jqXHR, settings) {
                    // Pull the token out of the DOM.
                    jqXHR.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                }
            });
        })

    });
    </script>
{% endblock %}
