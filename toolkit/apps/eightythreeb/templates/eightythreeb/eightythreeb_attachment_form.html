{% extends 'workspace/workspace_tool_form.html' %}

{% block page_title %}Upload your Scan{% endblock %}

{% block css %}
<link href="{{ STATIC_URL }}ajaxuploader/css/fileuploader.css" media="screen" rel="stylesheet" type="text/css" />
{% endblock %}

{% block header %}
<h4>Upload your Scan</h4>
{% endblock %}

{% block main %}
<div id="file-uploader">       
    <noscript>          
        <p>Please enable JavaScript to use file uploader.</p>
    </noscript>         
</div>

<div class="row">
<ul id="attachment_list">
    {% for a in object.attachment_set.all %}
    <li>
        <a target="_BLANK" href="{{ a.attachment.url }}">View</a>
        <a href="">Delete</a>
    </li>
    {% endfor %}
</ul>
</div>

{% endblock %}

{% block js %}
<script src="{{ STATIC_URL }}ajaxuploader/js/fileuploader.js" ></script>
<script>
$(function(){
    var uploader = new qq.FileUploader({
        action: "{% url 'eightythreeb:upload_file' slug=object.slug %}",
        element: $('#file-uploader:first')[0],
        multiple: true,
        onProgress: function(id, fileName, loaded, total){ 
            console.log(loaded)
        },
        onComplete: function(id, fileName, responseJSON) {
            if(responseJSON.success) {
                console.log('Success')
            } else {
                console.log('Failure')
            }
            console.log(fileName)
            console.log(responseJSON)
        },
        onAllComplete: function(uploads) {
            // uploads is an array of maps
            // the maps look like this: {file: FileObject, response: JSONServerResponse}
            console.log('Upload Complete')
            console.log(uploads)
        },
        params: {
            'csrf_token': '{{ csrf_token }}',
            'csrf_name': 'csrfmiddlewaretoken',
            'csrf_xname': 'X-CSRFToken',
        },
    });
});
</script>
{% endblock %}
